= javascript_include_tag 'https://api.tiles.mapbox.com/mapbox.js/v2.1.3/mapbox.js'
= stylesheet_link_tag 'https://api.tiles.mapbox.com/mapbox.js/v2.1.3/mapbox.css'

css:
  body { margin:0; padding:0; }
  #map { position:absolute; top:0; bottom:0; width:100%; }
  .reservoir-low{
    background:#c56e4f;
    //border:5px solid rgba(255,255,255,0.5);
    //color:#fff;
    font-weight:bold;
    text-align:center;
    border-radius:50%;
    line-height:60px;
  }
  .reservoir-medlow{
    background:#dbba65;
    //border:5px solid rgba(255,255,255,0.5);
    //color:#fff;
    font-weight:bold;
    text-align:center;
    border-radius:50%;
    line-height:60px;
  }
  .reservoir-normal{
    background:#7fad78;
    //border:5px solid rgba(255,255,255,0.5);
    //color:#fff;
    font-weight:bold;
    text-align:center;
    border-radius:50%;
    line-height:60px;
  }
  .reservoir-medhigh{
    background:#718aa5;
    //border:5px solid rgba(255,255,255,0.5);
    //color:#fff;
    font-weight:bold;
    text-align:center;
    border-radius:50%;
    line-height:60px;
  }
  .reservoir-high{
    background:#4d5d73;
    //border:5px solid rgba(255,255,255,0.5);
    //color:#fff;
    font-weight:bold;
    text-align:center;
    border-radius:50%;
    line-height:60px;
  }

div#map

div#water-system-detail
  h2.water-system-description Where Alameda gets its water from
  .reservoirs
    .reservoir Pardee
    .reservoir Camanche

  .reservoirs-summary
    h3.reservoirs-summary-header Overall Current Supply
    .reservoir-summary-chart


javascript:
  L.mapbox.accessToken = 'pk.eyJ1IjoiY2FyYm9uNSIsImEiOiJ6aV9uakxJIn0.ukQnv3tUrxQNlLb2KvktHw';

  var map = L.mapbox.map('map', 'carbon5.k10f7deo');
  function centerOnCalifornia() {
    map.setView([37, -120], 6);
  }
  centerOnCalifornia();

  var featureLayer = L.mapbox.featureLayer('/reservoir')
    .addTo(map);

  featureLayer.on('layeradd', function(event) {
    event.layer.bindPopup(event.layer.feature.properties.name);
    //event.layer.setIcon(L.icon({iconUrl: 'https://www.lawrenceks.org/assets/art/water.png',iconSize: [20, 20],}));
    var className;
    if (event.layer.feature.properties.percentage_full < 0.2 ) {
      className = "reservoir-low";
    } else if (event.layer.feature.properties.percentage_full < 0.4) {
      className = "reservoir-medlow";
    } else if (event.layer.feature.properties.percentage_full < 0.6) {
      className = "reservoir-normal";
    } else if (event.layer.feature.properties.percentage_full < 0.8) {
      className = "reservoir-medhigh";
    } else if (event.layer.feature.properties.percentage_full < 1.0) {
      className = "reservoir-high";
    }
    event.layer.setIcon(L.divIcon({className: className, iconSize: [15, 15]}));
    //event.layer.setOpacity(0.8);
  });

  $(".dropdown-menu li a").click(function(event){
    var filter;
    if (event.currentTarget.text === 'California') {
      filter = function() { return true; };
      centerOnCalifornia();
      $('#water-system-detail').removeClass('visible');
    } else {
      filter = function(feature) { return feature.properties.water_system === event.currentTarget.text; };
      map.fitBounds(featureLayer.getBounds());
      $('#water-system-detail').addClass('visible');
    }
    featureLayer.setFilter(filter);
  })
